# 指针和数组

## 1. 字符数组和字符串

```c
#include <stdio.h>
int main()
{
    char str1[] = "Hello world!";
    char str2[] = "Hello world!";
    char *str3 = "Hello world!";
    char *str4 = "Hello world!";
    
    if(str1 == str2)
    {
        printf("str1 == str2\n");
    }
    else
    {
        printf("str1 != str2\n");
    }
    
    if(str3 == str4)
    {
        printf("str3 == str4\n");
    }
    else
    {
        printf("str3 != str4\n");
    }
    
    printf("&str1[0] = %p\n", &str1[0]);
    printf("&str2[0] = %p\n", &str2[0]);
    printf("str3 = %p\n", str3);
    printf("str4 = %p\n", str4);
    
    return 0;
}
```

以上代码输出：

```c
str1 != str2
str3 == str4
&str1[0] = 0x7ffeeb4629cb
&str2[0] = 0x7ffeeb4629be
str3 = 0x10479def8
str4 = 0x10479def8
```

这里的str3和str4指向的是同一个常量字符串。C++/C会把常量字符串存储到单独的一个内存区域，不同指针指向同一个字符串的时候，他们实际会指向同一块内存。但是用相同的字符串去初始化数组的时候，会开辟不同的内存块，所以str1和str2不同。还需要注意的是`if(str1 == str2)`是比较的字符串首元素的地址的大小，字符串的比较不能直接使用`==`。

---

## 2. 指针和数组

### 2.1 数组名

除了以下两种情况外，一般情况下，数组名都代表数组首元素的地址。

数组名代表整个数组的情况：

+ `sizeof`中的数组名**\*(只出现数组名)**代表整个数组。

  `sizeof(arr)`这里的数组名代表的是整个数组，但是`sizeof(arr+0)`代表首元素**地址**的大小。

+ `&arr`代表整个数组。**\*(实际上`&arr`表示的是数组的地址，而不是数组首元素的地址，数组的地址+1，会跳过整个数组的大小)**

```c
int arr[5] = {1,2,3,4,5};
printf("sizeof(arr) -> %d\n", sizeof(arr));
printf("sizeof(arr+0) -> %d\n", sizeof(arr+0));
printf("sizeof(&arr) -> %d\n", sizeof(&arr));
printf("arr -> %p\n", arr);
printf("&arr -> %p\n", &arr);
printf("arr+1 -> %p\n", arr+1);
printf("&arr+1 -> %p\n", &arr+1);
```

输出：

```c
sizeof(arr) -> 20
sizeof(arr+0) -> 8	// 64bit环境下指针的大小为8字节，32bit环境下指针的大小为4字节，这里arr+0代表的是首元素地址
sizeof(&arr) -> 8	// 数组的地址大小(也是一个地址)，占8个字节。
arr -> 0x7ffeef8929a0
&arr -> 0x7ffeef8929a0
arr+1 -> 0x7ffeef8929a4		// 跳过了一个元素
&arr+1 -> 0x7ffeef8929b4	// 这里跳过了整个数组的大小(20)
```

对指针+1，实际上加的是这个指针类型的大小，比如整型指针+1，地址+4。

### 2.2 指针数组和数组指针如何区分

指针**数组**：是一个数组，数组的元素的指针。

数组**指针**：是一个指针，指向数组的指针。

从字面意思上来看就是谁在后就是什么东西。

```c
int *p1[10];
int (*p2)[10];
```

`int *p1[10]`这里的p1先和`[]`结合，所以他是数组，是指针数组。

`int (*p2)[10]`p2先和`*`结合，是指针，是数组指针。

### 2.3 数组指针的使用

数组指针  指向数组，那么数组指针中存的就是数组的地址咯。

```c
int main(int argc, const char * argv[])
{
    int arr[10] = {1,2,3,4,5,6,7,8,9,0};
    int (*p)[10] = &arr;
    return 0;
}
```

但一般不这么使用。一个数组指针的使用：

```c
void init_arr(int (*arr)[5], int row, int col)
{
    for(int i=0; i<row; i++)
    {
        for(int j=0; j<col; j++)
        {
            arr[i][j] = i+j;
        }
    }
}

void disp_arr(int (*arr)[5], int row, int col)
{
    for(int i=0; i<row; i++)
    {
        for(int j=0; j<col; j++)
        {
            printf("%d ", arr[i][j]);
        }
        printf("\n");
    }
}

int main()
{
    int arr[3][5] = {0};
    
    init_arr(arr, 3, 5);
    disp_arr(arr, 3, 5);
    
    return 0;
}
```

### 2.4 数组传参，指针传参

+ 一维数组传参

  ```c
  void test11(int arr[]){;}  // ok
  void test12(int arr[10]){;}    // ok
  void test13(int *arr){;}   // ok
  
  void test21(int *arr[20]){;}   // ok
  void test22(int **arr){;}  // ok
  
  int main()
  {
      int arr1[10] = {0};
      int *arr2[20] = {0};  //// 数组指针
      test11(arr1);
      test12(arr1);
      test13(arr1);
  
      test21(arr2);
      test22(arr2);
  
      return 0;
  }
  ```

+ 二维数组传参

  ```c
  void test(int arr[3][5]){;} // ok
  void test(int arr[][]){;}   // error!
  void test(int arr[][5]){;}  // ok
  void test(int *arr){;}  // error!
  
  void test(int* arr[5]){;} // error!
  void test(int (*arr)[5]){;} // OK!
  void test(int **arr){;} // error!
  
  int main()
  {
      int arr[3][5] = {0};
      test(arr);
      return 0;
  }
  ```



+ 一级指针传参

  ```c
  void print(int *p, int size)
  {
      for(int i=0; i<size; i++)
      {
          printf("%d\n", *(p+i));
      }
  }
  
  int main()
  {
      int arr[10] = {1,2,3,4,5,6,7,8,9};
      int *p = arr;
      int size = sizeof(arr)/sizeof(arr[0]);
      print(p, size);
      
      return 0;
  }
  ```

+ 二级指针传参

  ```c
  void test(int **p)
  {
      printf("%d\n", **p);
  }
  
  int main()
  {
      int n = 10;
      int *p = &n;
      int **pp = &p;
      test(&p);
      test(pp);
      
      return 0;
  }
  ```